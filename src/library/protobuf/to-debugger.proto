syntax = "proto3";

package fdbg;

enum Status {
  OK                   = 0;
  ERR_WRITING_MEMORY   = 1;
  TOO_MANY_BREAKPOINTS = 2;
  INVALID_MESSAGE      = 3;
  IO_SERIAL_ERROR      = 4;
}

message AckResponse {
  uint32 id = 1;
}

message WriteMemoryResponse {
  uint64 first_failed_pos = 1;
}

message ReadMemoryResponse {
  uint64 initial_pos = 1;
  bytes  bytes       = 2;
};

message ComputerStatus {
  uint64          pc        = 1;   // program counter
  repeated uint64 registers = 2;
  repeated bool   flags     = 3;
  bytes           stack     = 4;
};

message OptionalUint {
  bool   has = 1;
  uint64 value = 2;
};

message CycleResponse {
  uint64                pc = 1;
  repeated OptionalUint bytes = 2;
  repeated bool         bits = 3;
};

message BreakpointList {
  repeated uint64 addr = 1;
};

message RunStatus {
  bool   running = 1;
  uint64 pc = 2;
  // TODO - IO events
};

message ToDebugger {
  Status status = 1;
  oneof message {
    AckResponse         ack_response          = 2;
    WriteMemoryResponse write_memory_response = 3;
    ReadMemoryResponse  read_memory_response  = 4;
    ComputerStatus      computer_status       = 5;
    BreakpointList      breakpoint_list       = 6;
    CycleResponse       cycle_response        = 7;
    RunStatus           run_status            = 8;
  }
}